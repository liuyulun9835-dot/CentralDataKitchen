# OrderFlow‑V6 工程一致性与进度审计（修订 2.0 对照）

## 1. 结论
- 规范一致性：见 §2（BLOCKER/ WARN/ NIT 列表）。
- 安全与漏洞：见 §3（Bandit / pip‑audit / Secrets）。
- 分层工程化进度：见 §4（每层百分比与“已做/未做”）。

## 2. 规范一致性（对照《项目说明书_修订_2》/ README / todo）
- 数据来自 `/tmp/revision2_audit.json`：

```json
{  "violations": [    {      "id": "legacy_three_state",      "files": [        "OrderFlow V6 策略诊断与改进报告.txt",        "OrderFlow-V6项目说明书_修订_2.md",        "README.md",        "tools/extract_spec.py"      ]    }  ],  "warnings": [],  "notes": []}
```

> 注：`legacy_three_state` 表示旧“三态”引用残留；`missing_*` 为与修订 2.0 不一致处。

## 3. 安全与漏洞

* Bandit：`/tmp/bandit.json`（若存在高危则标记 BLOCKER）。
* 依赖漏洞：`/tmp/pip_audit.json`（必须给出可用的修复版本或抑制理由）。
* 秘钥扫描：`/tmp/secrets.json`。

## 4. 分层工程化进度与注释

* 评分 JSON：`output/results/audit_progress.json`

```json
{  "governance": {    "progress_pct": 100.0,    "done": [      "schema_model",      "schema_decision",      "rules_transition"    ],    "missing": []  },  "data": {    "progress_pct": 0.0,    "done": [],    "missing": [      "manifests",      "ingestion"    ]  },  "features": {    "progress_pct": 50.0,    "done": [      "macro_factor"    ],    "missing": [      "microflow"    ]  },  "model": {    "progress_pct": 66.7,    "done": [      "train_tvtp",      "state_inference"    ],    "missing": [      "artifact"    ]  },  "decision": {    "progress_pct": 100.0,    "done": [      "directional",      "rules_examples"    ],    "missing": []  },  "execution": {    "progress_pct": 100.0,    "done": [      "switch_policy"    ],    "missing": []  },  "validation": {    "progress_pct": 100.0,    "done": [      "univariate",      "multivariate",      "validator_cfg"    ],    "missing": []  },  "output": {    "progress_pct": 100.0,    "done": [      "validation_md"    ],    "missing": []  },  "docs": {    "progress_pct": 100.0,    "done": [      "readme",      "todo"    ],    "missing": []  }}
```

### 4.1 逐层备注

* **governance**：进度 100.0% 
  * 已完成：schema_model, schema_decision, rules_transition
  * 缺失：无
* **data**：进度 0.0% 
  * 已完成：无
  * 缺失：manifests, ingestion
* **features**：进度 50.0% 
  * 已完成：macro_factor
  * 缺失：microflow
* **model**：进度 66.7% 
  * 已完成：train_tvtp, state_inference
  * 缺失：artifact
* **decision**：进度 100.0% 
  * 已完成：directional, rules_examples
  * 缺失：无
* **execution**：进度 100.0% 
  * 已完成：switch_policy
  * 缺失：无
* **validation**：进度 100.0% 
  * 已完成：univariate, multivariate, validator_cfg
  * 缺失：无
* **output**：进度 100.0% 
  * 已完成：validation_md
  * 缺失：无
* **docs**：进度 100.0% 
  * 已完成：readme, todo
  * 缺失：无

## 5. 建议的修复顺序（只列顺序与要点，具体补丁另附）

1. 治理契约：补齐 `SCHEMA_model/decision` 与 `RULES_library` 的 transition 触发；
2. 模型接口：最小可运行的 `train_tvtp.py` 与 `state_inference.py`；
3. 决策：`directional_classifier.py` 与规则示例；
4. 特征：`features/macro_factor/*`；
5. Validator：方向性分层与 TVTP 宏观对比产出；
6. 发布门控：CI 校验“契约已填充 + 方向性报告存在”。
